#!/bin/bash

sudo /usr/sbin/sshd -Ded &
cmd="sdrunemacs --debug-init $@"
xorg_cmd="Xorg\
	-dpi $XORG_DPI\
	-noreset\
	-nolisten tcp\
	+extension GLX\
	+extension RANDR\
	+extension RENDER\
	-logfile ${WORKSPACE}/Xorg.log\
	-config /etc/xpra/xorg.conf"
mkdir -p /tmp/spacemacs-mmap
export TMPDIR=/tmp/spacemacs-mmap
xpra start $XPRA_DISPLAY\
     --xvfb="${xorg_cmd}"\
     --sharing="${XPRA_SHARING}"\
     --compress="${XPRA_COMPRESS}"\
     --keyboard-sync="${XPRA_KEYBOARD_SYNC}"\
     --no-daemon\
     --pulseaudio=no\
     --speaker=disabled\
     --mdns=no\
     --dpi="${XPRA_DPI}"\
     --mmap="${XPRA_MMAP}"\
     --encoding="${XPRA_ENCODING}"\
     -debug=all\
     --start-child="${cmd}"
